import{r as c,j as a}from"./react-CeYxiRmC.js";import{r as P}from"./index-ug2vDTIo.js";import{a as F}from"./axios-9PTFF6AP.js";import{m as N}from"./notify-DA3BzPi_.js";import{h as O,a as U}from"./react-router-BQwVR8Zd.js";import{s as j,S as C,C as W,B as q,j as z,b as H,c as J,k as E}from"./antd-CWlyDj0S.js";import{ab as K}from"./@ant-design-NQwz6VZX.js";import"./classnames-BK5ccKcQ.js";import"./react-dom-Bwn-WS6j.js";import"./scheduler-CzFDRTuY.js";import"./react-router-dom-o4KdQ8dK.js";import"./@remix-run-3jUiC8cZ.js";import"./@casl-D9HI8Hol.js";import"./@ucast-C1jhqbEt.js";import"./@reduxjs-Dg9g6cAv.js";import"./redux-DITMfSWq.js";import"./immer-DqxjFn0G.js";import"./redux-thunk-ClJT1hhx.js";import"./react-redux-BgQWloB6.js";import"./use-sync-external-store-Co5PKEhT.js";import"./rc-util-DVEPga9-.js";import"./@babel-Bssi87AP.js";import"./@emotion-CW87jbl0.js";import"./stylis-D5iaQeiq.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-resize-observer-OqVzQPEu.js";import"./rc-motion-C3tnhy2U.js";import"./@rc-component-B7glsBvU.js";import"./rc-notification-BU1JQ1oB.js";import"./rc-overflow-BHdZLj7t.js";import"./rc-picker-UBE7xiBA.js";import"./dayjs-Cjk_ngT2.js";import"./rc-tabs-CxzWAOyN.js";import"./rc-dropdown-BO-tmEXF.js";import"./rc-menu-CN7ruIKX.js";import"./rc-select-C2-AJ45Z.js";import"./rc-virtual-list-2uybl3mp.js";import"./rc-field-form-RBvcZ110.js";import"./scroll-into-view-if-needed-DRvhZyyj.js";import"./compute-scroll-into-view-J484ERGr.js";import"./rc-dialog-DjLbSgI8.js";import"./rc-switch-gTEUW9ud.js";import"./rc-table-mlfxtKPe.js";import"./rc-tree-XLUh9fGJ.js";import"./rc-checkbox-DSSeAk8Y.js";import"./rc-pagination-BIRv3rAM.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-input-BMc9GUi3.js";import"./rc-tooltip-Cl3xOnqL.js";import"./rc-textarea-GKK6NUoL.js";import"./copy-to-clipboard-iuHVwNMD.js";import"./toggle-selection-BHUZwh74.js";const Q="permissions",T=()=>F.get(`${Q}/groups`),V={getGroups:T},Te=()=>{const{id:d}=O(),I=U(),[S,g]=c.useState(!0),[G,v]=c.useState(!1),[b,k]=c.useState({id:"",name:null}),[u,x]=c.useState([]),[f,w]=c.useState([]),[D,y]=c.useState([]),[h,$]=c.useState({});c.useEffect(()=>{if(!d){j.error("Role ID is missing from the URL."),g(!1);return}(async()=>{g(!0);try{const[s,n,e]=await Promise.all([V.getGroups(),P.get(d),P.permissions(d)]);if(w(s.data.data.items||[]),$(s.data.data.groupPermissions||{}),k(n.data.data),e.data){let t=[];Object.values(e.data.data).forEach(m=>{m.forEach(l=>{t.push(l.id)})}),x(t);const o=[];(s.data.items||[]).forEach(m=>{var p;const l=((p=(s.data.groupPermissions||{})[m.id])==null?void 0:p.map(r=>r.id))||[];l.length>0&&l.every(r=>t.includes(r))&&o.push(m.id)}),y(o)}}catch{j.error("Failed to load role or permission data.")}finally{g(!1)}})()},[d]);const B=(i,s)=>{var e;const n=((e=h[i])==null?void 0:e.map(t=>t.id))||[];y(t=>s?[...new Set([...t,i])]:t.filter(o=>o!==i)),x(t=>{const o=new Set(t);return s?n.forEach(m=>o.add(m)):n.forEach(m=>o.delete(m)),Array.from(o)})},L=(i,s)=>{x(n=>{const e=s?[...new Set([...n,i])]:n.filter(t=>t!==i);return f.forEach(t=>{var p;const o=((p=h[t.id])==null?void 0:p.map(r=>r.id))||[],m=o.length>0&&o.every(r=>e.includes(r)),l=o.some(r=>e.includes(r));y(r=>{const R=r.includes(t.id);return m&&!R?[...r,t.id]:!l&&R?r.filter(M=>M!==t.id):r})}),e})},A=async()=>{if(d){v(!0);try{const i=await P.syncPermissions(d,{permissions:u}),{meta:s}=i.data;N(s.message,s.code),s.code===200&&I("/roles")}catch{j.error("Failed to submit permissions.")}finally{v(!1)}}};return a.jsx(C,{spinning:S&&!f.length,tip:"Loading data...",children:a.jsxs(W,{title:`Permissions for ${b.title||"Role"} (${b.name||"N/A"})`,loading:S,children:[a.jsx("div",{style:{marginBottom:16},children:a.jsx(q,{type:"primary",icon:a.jsx(K,{}),onClick:A,loading:G,children:"Save"})}),a.jsx(z,{}),(!S||f.length>0)&&a.jsx(C,{spinning:G,tip:"Saving...",children:a.jsxs(H,{gutter:[16,16],children:[" ",f.map(i=>{var s,n;return a.jsxs(J,{xs:24,sm:12,md:8,lg:6,children:[a.jsx(E,{checked:D.includes(i.id),indeterminate:((s=h[i.id])==null?void 0:s.some(e=>u.includes(e.id)))&&!((n=h[i.id])!=null&&n.every(e=>u.includes(e.id))),onChange:e=>B(i.id,e.target.checked),style:{fontWeight:"bold",marginBottom:"8px"},children:i.title}),a.jsx("div",{style:{display:"flex",flexDirection:"column-reverse",paddingLeft:"20px"},children:i.permissions.map(e=>a.jsx(E,{checked:u.includes(e.id),onChange:t=>L(e.id,t.target.checked),children:e.title},`permission-${e.id}`))})]},`group-${i.id}`)})]})})]})})};export{Te as default};
