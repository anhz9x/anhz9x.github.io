import{j as s,r as u}from"./react-CeYxiRmC.js";import{u as ae}from"./react-router-dom-o4KdQ8dK.js";import{u as se}from"./useDebounce-BApLLqdd.js";import{d as re,g as oe}from"./index-CBKo7eUj.js";import{a as x}from"./axios-9PTFF6AP.js";import{m,c as F}from"./notify-DFuPAhq-.js";import{u as ie,a as U}from"./react-redux-BgQWloB6.js";import{F as N}from"./constants-C-fR6r-u.js";import{b as le}from"./booking-service-QKILRns0.js";import{T as W,F as h,s as _,C as ne,b as V,c as C,B as b,i as ce,d as D,I as de,e as me}from"./antd-CWlyDj0S.js";import{h as pe}from"./react-router-BQwVR8Zd.js";import{af as ue,a6 as he,ae as fe,ag as ge,a9 as ye}from"./@ant-design-NQwz6VZX.js";import"./classnames-BK5ccKcQ.js";import"./react-dom-Bwn-WS6j.js";import"./scheduler-CzFDRTuY.js";import"./@remix-run-3jUiC8cZ.js";import"./@casl-D9HI8Hol.js";import"./@ucast-C1jhqbEt.js";import"./@reduxjs-Dg9g6cAv.js";import"./redux-DITMfSWq.js";import"./immer-DqxjFn0G.js";import"./redux-thunk-ClJT1hhx.js";import"./rc-util-DVEPga9-.js";import"./@babel-Bssi87AP.js";import"./@emotion-CW87jbl0.js";import"./stylis-D5iaQeiq.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-resize-observer-OqVzQPEu.js";import"./rc-motion-C3tnhy2U.js";import"./@rc-component-B7glsBvU.js";import"./rc-notification-BU1JQ1oB.js";import"./rc-overflow-BHdZLj7t.js";import"./rc-picker-UBE7xiBA.js";import"./dayjs-Cjk_ngT2.js";import"./rc-tabs-CxzWAOyN.js";import"./rc-dropdown-BO-tmEXF.js";import"./rc-menu-CN7ruIKX.js";import"./rc-select-C2-AJ45Z.js";import"./rc-virtual-list-2uybl3mp.js";import"./rc-field-form-RBvcZ110.js";import"./scroll-into-view-if-needed-DRvhZyyj.js";import"./compute-scroll-into-view-J484ERGr.js";import"./rc-dialog-DjLbSgI8.js";import"./rc-switch-gTEUW9ud.js";import"./rc-table-mlfxtKPe.js";import"./rc-tree-XLUh9fGJ.js";import"./rc-checkbox-DSSeAk8Y.js";import"./rc-pagination-BIRv3rAM.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-input-BMc9GUi3.js";import"./rc-tooltip-Cl3xOnqL.js";import"./rc-textarea-GKK6NUoL.js";import"./copy-to-clipboard-iuHVwNMD.js";import"./toggle-selection-BHUZwh74.js";import"./use-sync-external-store-Co5PKEhT.js";const j="booking-vehicles",ve=o=>x.get(`${j}/${o}`),be=o=>x.get(`${j}`,{params:o}),xe=o=>x.post(`${j}`,o),je=(o,g)=>x.put(`${j}/${o}`,g),ke=o=>x.delete(`${j}/${o}`),we=o=>x.delete(`${j}/all/${o}`),I={get:ve,gets:be,create:xe,update:je,destroy:ke,destroyAll:we},{Text:_e}=W,z=({data:o,fields:g})=>{if(!o||!g.length)return null;const O=g.map(p=>{const E=typeof p=="string"?p:p.key,y=typeof p=="string"?p:p.label||p.key,n=o[E];return n==null?null:`${y}: ${n}`}).filter(Boolean).join(" | ");return s.jsx(_e,{style:{fontSize:12,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},title:O,children:O})},S=o=>({keyword:o.keyword||null,booking_id:o.booking_id||null,page:o.page||1,per_page:o.per_page||10,status:o.status||null}),K=[{label:"Before pickup ",value:"BEFORE_PICKUP"},{label:"Waiting for customer",value:"WAITING_FOR_CUSTOMER"},{label:"After pickup",value:"AFTER_PICKUP"},{label:"Completed",value:"COMPLETED"},{label:"No show",value:"NO_SHOW"}],It=()=>{const o=ie(),{data:g}=U(t=>t.storeDriver),O=g.map(t=>({label:t.id+". "+t.name+" ("+t.phone_number+")",value:t.id})),{data:p}=U(t=>t.storeVehicle),E=p.map(t=>({label:t.id+". "+t.brand+" ("+t.registration+")",value:t.id}));u.useEffect(()=>{o(re({...N,sort_by:"name",sort_desc:!1})),o(oe({...N,sort_by:"brand",sort_desc:!1}))},[o]);const{id:y}=pe(),[n]=h.useForm(),[f,q]=ae(),[c,R]=u.useState(()=>({booking_id:y||"0",keyword:f.get("keyword")||null,page:parseInt(f.get("page")||"1",10),per_page:parseInt(f.get("per_page")||"10",10),status:f.get("status")||null})),T=se(c,500),[L,l]=u.useState(!1),[$,B]=u.useState({meta:{total:0,page:1,per_page:10},data:[]}),[H,v]=u.useState(!1),[P,G]=u.useState({id:"",ref:""});u.useEffect(()=>{const t={...c};Object.entries(t).forEach(([a,r])=>{r===null||r===""?f.delete(a):f.set(a,String(r))}),q(f)},[c]),u.useEffect(()=>{k(S(T))},[T]),u.useEffect(()=>{if(!y){_.error("Booking ID is missing from the URL."),l(!1);return}l(!0),(async()=>{var a,r;try{const e=await le.get(y),{data:i}=e.data;G({id:i.id,ref:i.ref})}catch(e){m((a=e==null?void 0:e.meta)==null?void 0:a.message,(r=e==null?void 0:e.meta)==null?void 0:r.code)}finally{l(!1)}})()},[y]);const k=async t=>{var a,r;l(!0);try{const e=await I.gets(t);B(e.data)}catch(e){m((a=e==null?void 0:e.meta)==null?void 0:a.message,(r=e==null?void 0:e.meta)==null?void 0:r.code)}finally{l(!1)}},Q=async t=>{var a,r;try{l(!0);const e=await I.create({...t,booking_id:P.id}),{meta:i}=e.data;m("Provide driver and vehicle for booking successful.",i.code),v(!1),n.resetFields(),await k(S(c))}catch(e){m((a=e==null?void 0:e.meta)==null?void 0:a.message,(r=e==null?void 0:e.meta)==null?void 0:r.code);const{errors:i}=e==null?void 0:e.data;Object.entries(i||{}).forEach(([d,w])=>{_.error(`${d}: ${w}`)})}finally{l(!1)}},M=(t,a)=>{a===void 0&&(a=null),R(r=>({...r,[t]:a,page:1}))},Y=()=>{n.resetFields(),v(!0)},A=()=>{v(!1),n.resetFields()},J=async t=>{var a,r;try{if(!await F("De-allocate a vehicle and driver?"))return;l(!0);const i=await I.destroy(t),{meta:d}=i.data;m("Delete driver and vehicle for booking successful.",d.code),v(!1),n.resetFields(),await k(S(c))}catch(e){m((a=e==null?void 0:e.meta)==null?void 0:a.message,(r=e==null?void 0:e.meta)==null?void 0:r.code);const{errors:i}=e==null?void 0:e.data;Object.entries(i||{}).forEach(([d,w])=>{_.error(`${d}: ${w}`)})}finally{l(!1)}},X=async()=>{var t,a;try{if(!await F("De-allocate a vehicle and driver?"))return;l(!0);const e=await I.destroyAll(P.id),{meta:i}=e.data;m("Delete all driver and vehicle for booking successful.",i.code),v(!1),n.resetFields(),await k(S(c))}catch(r){m((t=r==null?void 0:r.meta)==null?void 0:t.message,(a=r==null?void 0:r.meta)==null?void 0:a.code);const{errors:e}=r==null?void 0:r.data;Object.entries(e||{}).forEach(([i,d])=>{_.error(`${i}: ${d}`)})}finally{l(!1)}},Z=(t,a)=>{const r=$.data.map(e=>e.id===t?{...e,status:a}:e);B({...$,data:r})},ee=async t=>{var a,r;try{if(console.log("Row",t),!await F("Update status of a vehicle?"))return;l(!0);const i=await I.update(t.id,{status:t.status}),{meta:d}=i.data;m("Provide current location of a vehicle successful.",d.code),v(!1),n.resetFields(),await k(S(c))}catch(e){m((a=e==null?void 0:e.meta)==null?void 0:a.message,(r=e==null?void 0:e.meta)==null?void 0:r.code);const{errors:i}=e==null?void 0:e.data;Object.entries(i||{}).forEach(([d,w])=>{_.error(`${d}: ${w}`)})}finally{l(!1)}},te=[{title:"ID",dataIndex:"id",key:"id"},{title:"identifier",dataIndex:"identifier",key:"identifier"},{title:"Driver",dataIndex:"driver_name",key:"driver_name",render:(t,a)=>s.jsx(z,{data:a.driver,fields:[{key:"name",label:"Name"},{key:"phone_number",label:"Phone"},{key:"preferred_contact_method",label:"Contact"}]})},{title:"Vehicle",dataIndex:"vehicle_name",key:"vehicle_name",render:(t,a)=>s.jsx(z,{data:a.vehicle,fields:[{key:"brand",label:"Brand"},{key:"model",label:"Model"},{key:"registration",label:"Registration"}]})},{title:"Status",dataIndex:"status",key:"status",render:(t,a)=>s.jsxs("div",{children:[s.jsx(D,{variant:"borderless",value:t,options:K,style:{width:180},onChange:r=>Z(a.id,r)}),s.jsx(b,{title:"Update status of a vehicle",type:"link",icon:s.jsx(ge,{}),onClick:()=>ee(a)})]})},{title:"Actions",key:"actions",align:"center",width:120,render:(t,a)=>s.jsx("div",{children:s.jsx(b,{title:"Delete driver and vehicle",danger:!0,type:"link",icon:s.jsx(ye,{}),onClick:()=>J(a.id)})})}];return s.jsxs(ne,{children:[s.jsxs(V,{children:[s.jsx(C,{span:12,children:s.jsxs(W.Title,{level:4,children:[P.ref," | Information driver and vehicle"]})}),s.jsx(C,{span:3,offset:6,style:{marginTop:30,paddingRight:20},children:s.jsx(b,{type:"primary",danger:!0,icon:s.jsx(ue,{}),onClick:X,block:!0,children:"De-allocate all"})}),s.jsx(C,{span:3,style:{marginTop:30},children:s.jsx(b,{type:"primary",icon:s.jsx(he,{}),onClick:Y,block:!0,children:"Driver and Vehicle"})})]}),s.jsx(ce,{title:"Provide driver and vehicle details for a booking",open:H,onCancel:A,footer:null,children:s.jsxs(h,{form:n,layout:"vertical",onFinish:Q,children:[s.jsx(h.Item,{name:"driver_id",label:"Driver",rules:[{required:!0,message:"Please enter driver"}],children:s.jsx(D,{placeholder:"Select driver",options:O,allowClear:!0,showSearch:!0,filterOption:(t,a)=>((a==null?void 0:a.label)??"").toLowerCase().includes(t.toLowerCase())})}),s.jsx(h.Item,{name:"vehicle_id",label:"Vehicle",rules:[{required:!0,message:"Please enter vehicle"}],children:s.jsx(D,{placeholder:"Select vehicle",options:E,allowClear:!0,showSearch:!0,filterOption:(t,a)=>((a==null?void 0:a.label)??"").toLowerCase().includes(t.toLowerCase())})}),s.jsxs(h.Item,{children:[s.jsx(b,{type:"primary",htmlType:"submit",loading:L,children:"Provide"}),s.jsx(b,{onClick:A,style:{marginLeft:8},children:"Cancel"})]})]})}),s.jsx(h,{layout:"vertical",children:s.jsxs(V,{gutter:[16,0],children:[s.jsx(C,{xs:24,sm:12,md:6,lg:4,children:s.jsx(h.Item,{label:"Keyword",children:s.jsx(de,{placeholder:"Search by id, ref, vehicle",value:c.keyword||"",onChange:t=>M("keyword",t.target.value),allowClear:!0,prefix:s.jsx(fe,{})})})}),s.jsx(C,{xs:24,sm:12,md:6,lg:6,children:s.jsx(h.Item,{label:"Status",children:s.jsx(D,{placeholder:"Select status",value:c.status,onChange:t=>M("status",t),options:K,allowClear:!0,showSearch:!0,filterOption:(t,a)=>((a==null?void 0:a.label)??"").toLowerCase().includes(t.toLowerCase())})})})]})}),s.jsx(me,{size:"small",columns:te,dataSource:$.data,rowKey:"id",loading:L,pagination:{current:c.page,pageSize:c.per_page,total:$.meta.total,onChange:(t,a)=>R(r=>({...r,page:t,per_page:a}))}})]})};export{It as default};
