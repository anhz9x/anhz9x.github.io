import{j as e,r as l}from"./react-CeYxiRmC.js";import{u as Q}from"./react-router-dom-o4KdQ8dK.js";import{u as W}from"./useDebounce-BApLLqdd.js";import{b as M}from"./booking-service-QKILRns0.js";import{m as w}from"./notify-DFuPAhq-.js";import{T as $,j as X,S as B,b as v,c as u,B as j,s as E,F as x,C as Z,I as ee,d as te,e as ae,i as Y,l as se}from"./antd-CWlyDj0S.js";import{ac as ne,ad as re,a6 as oe,ae as ie,a2 as le}from"./@ant-design-NQwz6VZX.js";import{a as ce}from"./react-router-BQwVR8Zd.js";import"./classnames-BK5ccKcQ.js";import"./react-dom-Bwn-WS6j.js";import"./scheduler-CzFDRTuY.js";import"./@remix-run-3jUiC8cZ.js";import"./index-CBKo7eUj.js";import"./@casl-D9HI8Hol.js";import"./@ucast-C1jhqbEt.js";import"./@reduxjs-Dg9g6cAv.js";import"./redux-DITMfSWq.js";import"./immer-DqxjFn0G.js";import"./redux-thunk-ClJT1hhx.js";import"./axios-9PTFF6AP.js";import"./react-redux-BgQWloB6.js";import"./use-sync-external-store-Co5PKEhT.js";import"./rc-util-DVEPga9-.js";import"./@babel-Bssi87AP.js";import"./@emotion-CW87jbl0.js";import"./stylis-D5iaQeiq.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-resize-observer-OqVzQPEu.js";import"./rc-motion-C3tnhy2U.js";import"./@rc-component-B7glsBvU.js";import"./rc-notification-BU1JQ1oB.js";import"./rc-overflow-BHdZLj7t.js";import"./rc-picker-UBE7xiBA.js";import"./dayjs-Cjk_ngT2.js";import"./rc-tabs-CxzWAOyN.js";import"./rc-dropdown-BO-tmEXF.js";import"./rc-menu-CN7ruIKX.js";import"./rc-select-C2-AJ45Z.js";import"./rc-virtual-list-2uybl3mp.js";import"./rc-field-form-RBvcZ110.js";import"./scroll-into-view-if-needed-DRvhZyyj.js";import"./compute-scroll-into-view-J484ERGr.js";import"./rc-dialog-DjLbSgI8.js";import"./rc-switch-gTEUW9ud.js";import"./rc-table-mlfxtKPe.js";import"./rc-tree-XLUh9fGJ.js";import"./rc-checkbox-DSSeAk8Y.js";import"./rc-pagination-BIRv3rAM.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-input-BMc9GUi3.js";import"./rc-tooltip-Cl3xOnqL.js";import"./rc-textarea-GKK6NUoL.js";import"./copy-to-clipboard-iuHVwNMD.js";import"./toggle-selection-BHUZwh74.js";const{Text:A}=$,R=t=>t==null?"-":typeof t=="boolean"?t?"Yes":"No":typeof t=="object"?JSON.stringify(t):String(t),de=({title:t,data:s})=>!s||typeof s!="object"?null:e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(X,{orientation:"left",style:{margin:"8px 0",fontSize:12},children:t}),Object.entries(s).map(([i,d])=>e.jsxs("div",{style:{display:"flex",gap:6,fontSize:12,lineHeight:"18px"},children:[e.jsxs(A,{type:"secondary",style:{whiteSpace:"nowrap"},children:[i,":"]}),e.jsx(A,{children:R(d)})]},i))]}),T=({data:t})=>t?e.jsx("div",{children:Object.entries(t).map(([s,i])=>typeof i=="object"&&!Array.isArray(i)?e.jsx(de,{title:s.toUpperCase(),data:i},s):e.jsxs("div",{style:{display:"flex",gap:6,fontSize:12},children:[e.jsxs(A,{type:"secondary",children:[s,":"]}),e.jsx(A,{children:R(i)})]},s))}):null,pe=({notes:t})=>t?e.jsx("div",{style:{marginTop:8},children:Object.entries(t).map(([s,i])=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs(A,{type:"secondary",style:{fontSize:11},children:[i.notedate," Â· ",i.user]}),e.jsx("div",{style:{fontSize:12},dangerouslySetInnerHTML:{__html:i.note}})]},s))}):null,{Text:F}=$,me=({bookingRef:t})=>{const[s,i]=l.useState({booking:{general:{},arrival:{},departure:{}}}),[d,S]=l.useState(!0),[g,I]=l.useState(!1),[O,f]=l.useState(null),[b,N]=l.useState(!1);l.useEffect(()=>{i({booking:{general:{},arrival:{},departure:{}}}),(async()=>{var h,o;try{S(!0);const r=await M.info(t);i(r.data.data),f(null),I(!1)}catch(r){w((h=r==null?void 0:r.meta)==null?void 0:h.message,(o=r==null?void 0:r.meta)==null?void 0:o.code);const{errors:y}=r==null?void 0:r.data;Object.entries(y||{}).forEach(([C,D])=>{E.error(`${C}: ${D}`)})}finally{S(!1)}})()},[t]);const P=async()=>{var k,h;f(null);try{N(!0);const o=await M.note(t),{data:r}=o.data;f(r.notes)}catch(o){w((k=o==null?void 0:o.meta)==null?void 0:k.message,(h=o==null?void 0:o.meta)==null?void 0:h.code);const{errors:r}=o==null?void 0:o.data;Object.entries(r||{}).forEach(([y,C])=>{E.error(`${y}: ${C}`)})}finally{N(!1)}},_=async()=>{g||await P(),I(!g)};return d?e.jsx("div",{style:{height:"100%",minHeight:200,display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(B,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(v,{gutter:12,children:[e.jsxs(u,{span:24,lg:8,children:[e.jsx(F,{strong:!0,children:"General"}),e.jsx(T,{data:s.booking.general})]}),e.jsxs(u,{span:24,lg:8,children:[e.jsx(F,{strong:!0,children:"Arrival"}),e.jsx(T,{data:s.booking.arrival})]}),e.jsxs(u,{span:24,lg:8,children:[e.jsx(F,{strong:!0,children:"Departure"}),e.jsx(T,{data:s.booking.departure})]})]}),e.jsx(v,{style:{marginTop:8},children:e.jsx(u,{span:24,style:{display:"flex",justifyContent:"center"},children:e.jsx(j,{size:"small",type:"text",disabled:b,icon:g?e.jsx(ne,{}):e.jsx(re,{}),onClick:_,children:"Notes"})})}),g&&e.jsx(v,{children:e.jsx(u,{span:24,children:b?e.jsx(B,{size:"small"}):e.jsx(pe,{notes:O})})})]})},L=t=>({keyword:t.keyword||null,page:t.page||1,per_page:t.per_page||10,status:t.status||null}),ue=[{label:"Pending Booking Voucher ",value:"PCON"},{label:"Booking Voucher Approved",value:"ACON"},{label:"Pending Amendment",value:"PAMM"},{label:"Amendment Approved",value:"AAMM"},{label:"Pending Cancellation",value:"PCAN"},{label:"Cancellation Approved",value:"ACAN"}],ft=()=>{const[t]=x.useForm(),[s,i]=Q(),[d,S]=l.useState(()=>({keyword:s.get("keyword")||null,page:parseInt(s.get("page")||"1",10),per_page:parseInt(s.get("per_page")||"10",10),status:s.get("status")||null})),g=ce(),I=W(d,500),[O,f]=l.useState(!1),[b,N]=l.useState({meta:{total:0,page:1,per_page:10},data:[]}),[P,_]=l.useState(!1),[k,h]=l.useState(!1),[o,r]=l.useState(null);l.useEffect(()=>{const n={...d};Object.entries(n).forEach(([a,c])=>{c===null||c===""?s.delete(a):s.set(a,String(c))}),i(s)},[d]),l.useEffect(()=>{y(L(I))},[I]);const y=async n=>{var a,c;f(!0);try{const p=await M.gets(n);N(p.data)}catch(p){w((a=p==null?void 0:p.meta)==null?void 0:a.message,(c=p==null?void 0:p.meta)==null?void 0:c.code)}finally{f(!1)}},C=async n=>{var a,c,p;try{f(!0);const m=await M.create({last_action_date:n.last_action_date?(a=n.last_action_date)==null?void 0:a.format("YYYY-MM-DD"):null}),{meta:G}=m.data,{data:J}=m.data;w(J.message,G.code),_(!1),t.resetFields(),await y(L(d))}catch(m){w((c=m==null?void 0:m.meta)==null?void 0:c.message,(p=m==null?void 0:m.meta)==null?void 0:p.code)}finally{f(!1)}},D=(n,a)=>{a===void 0&&(a=null),S(c=>({...c,[n]:a,page:1}))},V=n=>{g(`/bookings/${n.id}/events`)},H=()=>{r(null),t.resetFields(),_(!0)},z=()=>{_(!1),r(null),t.resetFields()},K=n=>{r(n),h(!0)},U=()=>{h(!1),r(null)},q=[{title:"ID",dataIndex:"id",key:"id"},{title:"Ref",dataIndex:"ref",key:"ref",render:(n,a)=>e.jsx(j,{type:"link",onClick:()=>K(a),className:"text-center",title:"Information from holiday taxis",children:a.ref})},{title:"Vehicle",dataIndex:"vehicle",key:"vehicle"},{title:"Passenger name",dataIndex:"passenger_name",key:"passenger_name"},{title:"Passenger tel no",dataIndex:"passenger_tel_no",key:"passenger_tel_no"},{title:"Arrival date",dataIndex:"arrival_date",key:"arrival_date"},{title:"Departure date",dataIndex:"departure_date",key:"departure_date"},{title:"Last action date",dataIndex:"last_action_date",key:"last_action_date"},{title:"Order ref",dataIndex:"order_ref",key:"order_ref"},{title:"Status",dataIndex:"status",key:"status"},{title:"Actions",key:"actions",align:"center",width:120,render:(n,a)=>e.jsx("div",{children:e.jsx(j,{title:"Information driver and vehicle",type:"link",icon:e.jsx(le,{}),onClick:()=>V(a)})})}];return e.jsxs(Z,{children:[e.jsxs(v,{children:[e.jsx(u,{span:12,children:e.jsx($.Title,{level:4,children:"Bookings"})}),e.jsx(u,{span:2,offset:10,style:{marginTop:30},children:e.jsx(j,{type:"primary",icon:e.jsx(oe,{}),onClick:H,block:!0,children:"Sync"})})]}),e.jsx(x,{layout:"vertical",children:e.jsxs(v,{gutter:[16,0],children:[e.jsx(u,{xs:24,sm:12,md:6,lg:4,children:e.jsx(x.Item,{label:"Keyword",children:e.jsx(ee,{placeholder:"Search by id, ref, vehicle",value:d.keyword||"",onChange:n=>D("keyword",n.target.value),allowClear:!0,prefix:e.jsx(ie,{})})})}),e.jsx(u,{xs:24,sm:12,md:6,lg:6,children:e.jsx(x.Item,{label:"Status",children:e.jsx(te,{placeholder:"Select status",value:d.status,onChange:n=>D("status",n),options:ue,allowClear:!0,showSearch:!0,filterOption:(n,a)=>((a==null?void 0:a.label)??"").toLowerCase().includes(n.toLowerCase())})})})]})}),e.jsx(ae,{size:"small",columns:q,dataSource:b.data,rowKey:"id",loading:O,pagination:{current:d.page,pageSize:d.per_page,total:b.meta.total,onChange:(n,a)=>S(c=>({...c,page:n,per_page:a}))}}),e.jsx(Y,{title:"Sync data from the API",open:P,onCancel:z,footer:null,children:e.jsxs(x,{form:t,layout:"vertical",onFinish:C,children:[e.jsx(x.Item,{name:"last_action_date",label:"Sync date",rules:[{required:!0,message:"Please select sync date"}],children:e.jsx(se,{format:"YYYY-MM-DD",className:"w-full rounded-md"})}),e.jsxs(x.Item,{children:[e.jsx(j,{type:"primary",htmlType:"submit",loading:O,children:"Sync"}),e.jsx(j,{onClick:z,style:{marginLeft:8},children:"Cancel"})]})]})}),e.jsx(Y,{style:{top:100},width:"90%",title:"Information from holiday taxis",open:k,onCancel:U,footer:null,children:e.jsx(me,{bookingRef:o==null?void 0:o.ref})})]})};export{ft as default};
